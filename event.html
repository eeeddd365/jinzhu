<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>çœŸç  | å°ˆå±¬é™å®šé»é¤</title>
    <link rel="stylesheet" href="https://www.jinzhu.com.tw/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://www.jinzhu.com.tw/css/animate.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@700;900&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --p-green: #004d40; --p-gold: #b89150; --p-cream: #f9f5f0; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--p-cream); }
        .font-serif { font-family: 'Noto Serif TC', serif; }
        
        .navbar-custom { background-color: #ffffff; height: 60px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: fixed; top: 0; width: 100%; z-index: 1000; }
        
        /* KV èƒŒæ™¯å€å„ªåŒ–ï¼šç¢ºä¿å…§å®¹åœ¨ä¸­å¤® */
        .kv-section { height: 100vh; transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1); overflow: hidden; position: relative; z-index: 50; display: flex; align-items: center; justify-content: center; }
        .kv-hidden { height: 0px !important; opacity: 0; }
        
        /* ç™»éŒ„å¡ç‰‡æ¨£å¼ */
        .login-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 2.5rem; width: 90%; max-width: 400px; padding: 2.5rem; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
        
        .cat-btn { border: 1px solid var(--p-green); color: var(--p-green); padding: 6px 18px; border-radius: 999px; white-space: nowrap; font-weight: bold; font-size: 0.9rem; }
        .cat-active { background-color: var(--p-green) !important; color: #fff !important; }
        .sticky-nav { position: sticky; top: 60px; z-index: 40; background: rgba(249, 245, 240, 0.95); padding: 12px 8px; backdrop-filter: blur(8px); }
        .img-contain { width: 100%; height: 100%; object-fit: contain; }
        
        /* è©³æƒ…å½ˆçª—ä¿®å¾© */
        .btn-close-custom { position: absolute; top: 12px; right: 12px; background: rgba(0,0,0,0.4); color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 2200; font-size: 16px; border: none; }
        .modal-content-wrap { background: white; width: 100%; max-width: 500px; max-height: 85vh; border-radius: 1.5rem 1.5rem 0 0; display: flex; flex-direction: column; position: relative; }
        .scroll-area { overflow-y: auto; -webkit-overflow-scrolling: touch; }
    </style>
</head>
<body class="pb-24 text-slate-800 text-left">

    <header class="navbar-custom">
        <img src="https://www.jinzhu.com.tw/images/Jinzhu_logo.svg" style="max-height:35px">
    </header>

    <div id="kv-area" class="kv-section bg-stone-900">
        <img src="https://www.jinzhu.com.tw/storage/website/kv/jinzhu20230904143032_PC-KV.jpeg" class="absolute inset-0 w-full h-full object-cover opacity-60">
        
        <div id="step-1" class="relative z-10 flex flex-col items-center w-full animate__animated animate__fadeIn">
            <div class="text-center mb-8">
                <h2 id="act-title-kv" class="text-4xl font-black text-white font-serif tracking-tight drop-shadow-lg">æ´»å‹•é¸å–®</h2>
                <p id="event-code-display" class="text-p-gold font-bold tracking-[0.3em] uppercase mt-2 text-sm"></p>
            </div>

            <div class="login-card border border-white/20">
                <div class="space-y-6">
                    <div>
                        <label class="text-[10px] font-bold text-stone-400 block mb-1 uppercase tracking-widest text-left">å§“å Name</label>
                        <input type="text" id="custName" placeholder="è«‹è¼¸å…¥è¨‚ä½å§“å" class="w-full border-b border-stone-200 py-2 bg-transparent outline-none focus:border-p-green transition">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-stone-400 block mb-1 uppercase tracking-widest text-left">é›»è©± Phone</label>
                        <input type="tel" id="custPhone" placeholder="è«‹è¼¸å…¥è¯çµ¡é›»è©±" class="w-full border-b border-stone-200 py-2 bg-transparent outline-none focus:border-p-green transition">
                    </div>
                    <button onclick="startOrder()" class="w-full bg-[#004d40] text-white py-4 rounded-full font-bold shadow-xl mt-4 active:scale-95 transition tracking-widest">ç¢ºèªä¸¦é€²å…¥é¸å–®</button>
                </div>
            </div>
        </div>
    </div>

    <main id="main-content" class="max-w-xl mx-auto p-4 relative z-20">
        <section id="step-2" class="hidden">
            <div class="text-center mb-6 mt-4">
                <h2 id="act-title-menu" class="text-2xl font-black text-p-green font-serif">æ´»å‹•é¸å–®</h2>
                <div class="w-12 h-1 bg-p-gold mx-auto mt-2 rounded-full"></div>
            </div>
            <div id="cat-nav" class="flex gap-2 overflow-x-auto sticky-nav no-scrollbar mb-4"></div>
            <div id="menu-grid" class="grid grid-cols-1 gap-4"></div>
        </section>

        <section id="step-3" class="hidden py-10 px-4 text-center">
            <div class="bg-white p-10 rounded-[3rem] shadow-2xl border-t-8 border-[#004d40] animate__animated animate__fadeInUp">
                <div class="w-20 h-20 bg-emerald-50 rounded-full flex items-center justify-center text-4xl mx-auto mb-6">ğŸ¥¢</div>
                <h2 class="text-2xl font-black text-[#004d40] mb-3 font-serif">å·²æ”¶åˆ°æ‚¨çš„é å®š</h2>
                <p class="text-stone-600 mb-8 font-bold leading-relaxed">çœŸå¿ƒæ¬¾å¾…ï¼Œèª æ‘¯æº–å‚™ã€‚<br>æœŸå¾…æ‚¨çš„å…‰è‡¨ã€‚</p>
                <button onclick="location.href='query.html'" class="w-full max-w-xs border-2 border-[#004d40] py-4 rounded-full font-bold text-[#004d40]">å‰å¾€è¨‚å–®æŸ¥è©¢</button>
            </div>
        </section>
    </main>

    <script>
        const SUPABASE_URL = 'https://pydlnqriztpzgxbjuohm.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_ISKUWOXUR9A-1y81xCOUXg_8-zNle3v';
        const _s = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        const urlParams = new URLSearchParams(window.location.search);
        const campaignCode = urlParams.get('code');
        
        let menuData = [], cart = [], guest = {}, tempItem = null, currentQty = 1;

        async function init() {
            if(!campaignCode) {
                alert("æ­¤æ´»å‹•é€£çµå·²å¤±æ•ˆ");
                return location.href = "index.html";
            }
            document.getElementById('act-title-kv').innerText = campaignCode;
            document.getElementById('act-title-menu').innerText = `${campaignCode} é™å®šé¸å–®`;
            document.getElementById('event-code-display').innerText = campaignCode;
        }
        init();

        async function startOrder() {
            guest = { name: document.getElementById('custName').value, phone: document.getElementById('custPhone').value };
            if(!guest.name || !guest.phone) return alert("è«‹å®Œæ•´å¡«å¯«å§“åèˆ‡é›»è©±");
            
            // é»æ“Šå¾Œå°‡æ•´å€‹èƒŒæ™¯å€ç¸®å°ä¸¦éš±è—ç™»éŒ„æ¡†
            document.getElementById('kv-area').classList.add('kv-hidden');
            document.getElementById('step-2').classList.remove('hidden');
            // ... å…¶é¤˜é‚è¼¯
        }
        // ... (ä¿ç•™åŸæœ‰çš„ loadEventContent, renderItems, openDetail, finalSubmit ç­‰å‡½å¼)
    </script>
</body>
</html>
