<!DOCTYPE html>
<html lang="zh-TW">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>çœŸç  | æ–‡å¿ƒåº—ç·šä¸Šé é»é¤</title>
Â  Â  <link rel="stylesheet" href="https://www.jinzhu.com.tw/bootstrap/css/bootstrap.min.css">
Â  Â  <link rel="stylesheet" href="https://www.jinzhu.com.tw/css/animate.css">
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@700;900&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
Â  Â  <style>
Â  Â  Â  Â  :root { --p-green: #004d40; --p-gold: #b89150; --p-cream: #f9f5f0; }
Â  Â  Â  Â  body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--p-cream); -webkit-tap-highlight-color: transparent; }
Â  Â  Â  Â  .font-serif { font-family: 'Noto Serif TC', serif; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .navbar-custom { background-color: #ffffff; height: 60px; display: flex; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: fixed; top: 0; width: 100%; z-index: 1000; }
Â  Â  Â  Â  .navbar-brand img { max-height: 40px; image-rendering: -webkit-optimize-contrast; object-fit: contain; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* å´é‚Šæ¼¢å ¡é¸å–® */
Â  Â  Â  Â  .side-menu { position: fixed; top: 0; right: -280px; width: 280px; height: 100%; background: var(--p-green); z-index: 2000; transition: 0.4s; padding: 80px 20px; box-shadow: -5px 0 15px rgba(0,0,0,0.2); }
Â  Â  Â  Â  .side-menu.active { right: 0; }
Â  Â  Â  Â  .menu-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1500; display: none; }
Â  Â  Â  Â  .menu-overlay.active { display: block; }
Â  Â  Â  Â  .menu-link { color: white; font-size: 1.2rem; font-weight: bold; text-decoration: none; display: block; padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }

Â  Â  Â  Â  .kv-section { height: 100vh; transition: all 0.7s ease; overflow: hidden; position: relative; }
Â  Â  Â  Â  .kv-hidden { height: 0px !important; }
Â  Â  Â  Â  .main-title { font-size: 2.2rem; letter-spacing: 0.15em; text-shadow: 0 2px 10px rgba(0,0,0,0.3); font-weight: 700; color: #fff; }
Â  Â  Â  Â  .order-card { margin-top: -160px; position: relative; z-index: 10; background: #fff; border-radius: 2rem; box-shadow: 0 20px 50px rgba(0,0,0,0.1); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .cat-btn { border: 1px solid var(--p-green); color: var(--p-green); padding: 6px 18px; border-radius: 999px; white-space: nowrap; font-weight: bold; font-size: 0.9rem; }
Â  Â  Â  Â  .cat-active { background-color: var(--p-green) !important; color: #fff !important; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* é¸é …æ¨£å¼ */
Â  Â  Â  Â  .flavor-selected { border-color: var(--p-gold) !important; background-color: var(--p-green) !important; color: white !important; font-weight: bold; }
Â  Â  Â  Â  .opt-selected { border: 2.5px solid var(--p-gold) !important; background-color: #fdf6e9 !important; font-weight: bold; }
Â  Â  Â  Â  .sticky-nav { position: sticky; top: 60px; z-index: 40; background: rgba(249, 245, 240, 0.95); padding: 12px 8px; backdrop-filter: blur(8px); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* å½ˆçª—ï¼šå…¨å…§å®¹æ»¾å‹•å„ªåŒ– */
Â  Â  Â  Â  .btn-close-custom {Â 
Â  Â  Â  Â  Â  Â  position: absolute; top: 12px; right: 12px;Â 
Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.4); color: white;Â 
Â  Â  Â  Â  Â  Â  width: 32px; height: 32px; border-radius: 50%;Â 
Â  Â  Â  Â  Â  Â  display: flex; align-items: center; justify-content: center;Â 
Â  Â  Â  Â  Â  Â  z-index: 2200; font-size: 16px; border: none; backdrop-filter: blur(4px);
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #detail-modal .modal-content-wrap {Â 
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  max-width: 500px;
Â  Â  Â  Â  Â  Â  max-height: 85vh; /* å½ˆçª—é«˜åº¦æœ€é«˜ä½” 85% */
Â  Â  Â  Â  Â  Â  border-radius: 1.5rem 1.5rem 0 0;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  }

Â  Â  Â  Â  .scroll-area {Â 
Â  Â  Â  Â  Â  Â  overflow-y: auto;Â 
Â  Â  Â  Â  Â  Â  -webkit-overflow-scrolling: touch;
Â  Â  Â  Â  }

Â  Â  Â  Â  .img-wrap {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  background: white;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .img-wrap img { width: 100%; max-height: 250px; object-fit: contain; }

Â  Â  Â  Â  .no-scrollbar::-webkit-scrollbar { display: none; }
Â  Â  </style>
</head>
<body class="pb-24 text-slate-800">

Â  Â  <header class="navbar-custom px-4 justify-between">
Â  Â  Â  Â  <div class="w-10"></div>
Â  Â  Â  Â  <a class="navbar-brand" href="#" onclick="location.reload()">
Â  Â  Â  Â  Â  Â  <img id="main-logo" src="https://www.jinzhu.com.tw/images/Jinzhu_logo.svg" alt="logo">
Â  Â  Â  Â  </a>
Â  Â  Â  Â  <button onclick="toggleMenu()" class="text-p-green text-2xl px-2">â˜°</button>
Â  Â  </header>

Â  Â  <div id="menu-overlay" class="menu-overlay" onclick="toggleMenu()"></div>
Â  Â  <nav id="side-menu" class="side-menu text-left">
Â  Â  Â  Â  <button onclick="toggleMenu()" class="absolute top-5 right-5 text-white text-2xl">âœ•</button>
Â  Â  Â  Â  <a href="index.html" class="menu-link font-serif">é¦–é  Home</a>
Â  Â  Â  Â  <a href="query.html" class="menu-link font-serif">è¨‚å–®æŸ¥è©¢ Tracking</a>
Â  Â  Â  Â  <div class="mt-10 text-white/40 text-[10px] uppercase tracking-widest font-bold text-center">Jin Zhu Taichung</div>
Â  Â  </nav>

Â  Â  <div id="kv-area" class="kv-section bg-stone-900">
Â  Â  Â  Â  <img id="kv-bg" src="" class="absolute inset-0 w-full h-full object-cover opacity-60">
Â  Â  Â  Â  <div class="absolute inset-0 flex flex-col items-center justify-center text-center">
Â  Â  Â  Â  Â  Â  <h2 class="main-title font-serif animate__animated animate__fadeIn">å°ç£ä½³å‘³ JIN-ZHU</h2>
Â  Â  Â  Â  Â  Â  <p class="text-white/80 font-serif tracking-[0.4em] mt-2 animate__animated animate__fadeIn animate__delay-1s">å‚³æ‰¿å¿ƒæ„ï¼ç©å‘³æ–°æ„</p>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <main id="main-content" class="max-w-xl mx-auto p-4 relative z-20 text-left">
Â  Â  Â  Â  <section id="step-1" class="animate__animated animate__slideInUp">
Â  Â  Â  Â  Â  Â  <div class="order-card p-8 border border-white">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-xl font-bold text-p-green text-center mb-8 font-serif tracking-widest uppercase">æ–‡å¿ƒåº— é é»é¤æœå‹™</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><label class="text-[10px] font-bold text-stone-400 block mb-1 uppercase tracking-widest">å§“å Name</label><input type="text" id="custName" placeholder="è«‹è¼¸å…¥è¨‚ä½å§“å" class="w-full border-b py-2 bg-transparent outline-none focus:border-p-green"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><label class="text-[10px] font-bold text-stone-400 block mb-1 uppercase tracking-widest">é›»è©± Phone</label><input type="tel" id="custPhone" placeholder="è«‹è¼¸å…¥è¯çµ¡é›»è©±" class="w-full border-b py-2 bg-transparent outline-none focus:border-p-green"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="startOrder()" class="w-full bg-[#004d40] text-white py-4 rounded-full font-bold shadow-lg mt-4 active:scale-95 transition">é€²å…¥é¸å–®</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </section>

Â  Â  Â  Â  <section id="step-2" class="hidden">
Â  Â  Â  Â  Â  Â  <div id="cat-nav" class="flex gap-2 overflow-x-auto sticky-nav no-scrollbar mb-4"></div>
Â  Â  Â  Â  Â  Â  <div id="menu-grid" class="grid grid-cols-1 gap-4"></div>
Â  Â  Â  Â  </section>

Â  Â  Â  Â  <section id="step-3" class="hidden py-10 px-4 mt-10 text-center">
Â  Â  Â  Â  Â  Â  <div class="bg-white p-10 rounded-[3rem] shadow-2xl border-t-8 border-[#004d40] animate__animated animate__fadeInUp">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-20 h-20 bg-emerald-50 rounded-full flex items-center justify-center text-4xl mx-auto mb-6">ğŸ¥¢</div>
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-black text-[#004d40] mb-3 font-serif text-center">å·²æ”¶åˆ°æ‚¨çš„é å®š</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-12 h-1 bg-[#b89150] mx-auto mb-6 rounded-full"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-stone-600 mb-2 leading-relaxed font-bold text-center">çœŸå¿ƒæ¬¾å¾…ï¼Œèª æ‘¯æº–å‚™ã€‚</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-stone-500 text-sm mb-10 leading-relaxed text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  å¦‚éœ€ç•°å‹•å…§å®¹è«‹è‡´é›»çµ¦æˆ‘å€‘ï¼š<br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="tel:0437027538" class="text-p-gold font-bold text-xl block mt-2 underline">04-3702-7538</a>
Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="location.href='query.html'" class="w-full max-w-xs border-2 border-[#004d40] py-4 rounded-full font-bold text-[#004d40]">å‰å¾€è¨‚å–®æŸ¥è©¢</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </section>
Â  Â  </main>

Â  Â  <div id="detail-modal" class="fixed inset-0 bg-black/80 z-[110] hidden flex items-end justify-center backdrop-blur-sm">
Â  Â  Â  Â  <div class="modal-content-wrap animate__animated animate__slideInUp animate__faster">
Â  Â  Â  Â  Â  Â  <button onclick="closeDetail()" class="btn-close-custom">âœ•</button>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="scroll-area flex-1 no-scrollbar">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="img-wrap">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="detail-img" src="">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-6 pt-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 id="detail-title" class="text-2xl font-bold text-p-green mb-1 font-serif text-left"></h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="detail-desc" class="text-stone-400 text-xs mb-6 text-left"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="flavor-container" class="space-y-6"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="set-group-container" class="space-y-8 border-t mt-6 pt-6"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="h-10"></div> </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="p-3 bg-stone-50 border-t">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-3 bg-white border rounded-xl p-1 px-3 shadow-sm h-10">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="changeQty(-1)" class="text-lg text-stone-300 font-bold px-1">ï¼</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="item-qty" class="w-5 text-center font-bold text-p-green text-base">1</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="changeQty(1)" class="text-lg text-p-green font-bold px-1">ï¼‹</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="closeDetail()" class="flex-1 h-10 border rounded-xl text-stone-400 font-bold text-xs bg-white uppercase">Cancel</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="add-btn" class="flex-[2] h-10 bg-[#004d40] text-white rounded-xl font-bold shadow-md text-xs">åŠ å…¥é é»æ¸…å–®</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="preview-modal" class="fixed inset-0 bg-black/80 z-[120] hidden flex items-center justify-center p-4 backdrop-blur-sm text-left">
Â  Â  Â  Â  <div class="bg-white w-full max-w-md rounded-[2rem] overflow-hidden flex flex-col max-h-[85vh]">
Â  Â  Â  Â  Â  Â  <div class="p-4 bg-stone-50 border-b font-bold text-center font-serif text-p-green">é é»é¤æ˜ç´°</div>
Â  Â  Â  Â  Â  Â  <div class="flex-1 overflow-y-auto p-4 space-y-3 no-scrollbar" id="preview-list"></div>
Â  Â  Â  Â  Â  Â  <div class="p-4 border-t bg-white">
Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="order-note" class="w-full border rounded-xl p-3 bg-stone-50 text-xs mb-4 outline-none focus:border-p-gold h-20" placeholder="å‚™è¨» (ä¾‹: å»è”¥ã€ä¸éœ€è¦é¤å…·...)"></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-end mb-4 px-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-left">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs text-stone-400 font-bold block uppercase tracking-tighter">Total Amount</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-[9px] text-p-gold font-bold leading-tight">* ä¸åŒ…å«æœå‹™è²»ï¼Œé‡‘é¡ä»¥ç¾å ´ç‚ºä¸»</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="preview-total" class="text-2xl font-black text-p-green font-serif">$0</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="closePreview()" class="w-20 py-4 border rounded-2xl text-stone-400 font-bold">è¿”å›</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button finalSubmit onclick="finalSubmit()" class="flex-1 bg-[#004d40] text-white py-4 rounded-2xl font-bold shadow-lg">ç¢ºèªé€å‡ºé å®š</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="cart-bar" class="fixed bottom-6 left-4 right-4 max-w-xl mx-auto z-50 hidden animate__animated animate__fadeInUp">
Â  Â  Â  Â  <button onclick="openPreview()" class="w-full bg-[#004d40] p-1.5 pl-6 pr-1.5 rounded-full flex justify-between items-center shadow-2xl active:scale-95 transition">
Â  Â  Â  Â  Â  Â  <span class="text-white font-bold tracking-widest text-sm font-serif">æŸ¥çœ‹é é»æ˜ç´°</span>
Â  Â  Â  Â  Â  Â  <div id="cart-count" class="bg-[#b89150] text-white w-9 h-9 rounded-full flex items-center justify-center font-black shadow-inner">0</div>
Â  Â  Â  Â  </button>
Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  const SUPABASE_URL = 'https://pydlnqriztpzgxbjuohm.supabase.co';
Â  Â  Â  Â  const SUPABASE_KEY = 'sb_publishable_ISKUWOXUR9A-1y81xCOUXg_8-zNle3v';
Â  Â  Â  Â  const _s = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

Â  Â  Â  Â  let menuData = [], cart = [], guest = {}, tempItem = null, currentQty = 1;

Â  Â  Â  Â  async function init() {
Â  Â  Â  Â  Â  Â  const isMob = window.innerWidth <= 768;
Â  Â  Â  Â  Â  Â  const { data } = await _s.from('store_settings').select('logo_url').eq('id', 1).single();
Â  Â  Â  Â  Â  Â  if (data?.logo_url) document.getElementById('main-logo').src = `${data.logo_url}?t=${Date.now()}`;
Â  Â  Â  Â  Â  Â  document.getElementById('kv-bg').src = isMob ? "https://www.jinzhu.com.tw/storage/website/kv/jinzhu20230904143032_Mobile-KV.jpeg" : "https://www.jinzhu.com.tw/storage/website/kv/jinzhu20230904143032_PC-KV.jpeg";
Â  Â  Â  Â  }
Â  Â  Â  Â  init();

Â  Â  Â  Â  function toggleMenu() {
Â  Â  Â  Â  Â  Â  document.getElementById('side-menu').classList.toggle('active');
Â  Â  Â  Â  Â  Â  document.getElementById('menu-overlay').classList.toggle('active');
Â  Â  Â  Â  }

Â  Â  Â  Â  async function startOrder() {
Â  Â  Â  Â  Â  Â  guest = { name: document.getElementById('custName').value, phone: document.getElementById('custPhone').value };
Â  Â  Â  Â  Â  Â  if(!guest.name || !guest.phone) return alert("è«‹å¡«å¯«å§“åèˆ‡é›»è©±");
Â  Â  Â  Â  Â  Â  document.getElementById('kv-area').classList.add('kv-hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('step-1').classList.add('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('step-2').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  document.getElementById('cart-bar').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  loadContent();
Â  Â  Â  Â  }

Â  Â  Â  Â  async function loadContent() {
Â  Â  Â  Â  Â  Â  const { data: cats } = await _s.from('categories').select('*').eq('is_visible', true).order('sort_order');
Â  Â  Â  Â  Â  Â  const { data: items } = await _s.from('menu_items').select('*, item_flavor_relation(flavor_groups(*, flavor_options(*))), set_menu_groups(*, set_menu_contents(menu_items(*, item_flavor_relation(flavor_groups(*, flavor_options(*))))))').eq('is_hidden', false);
Â  Â  Â  Â  Â  Â  menuData = items;
Â  Â  Â  Â  Â  Â  document.getElementById('cat-nav').innerHTML = (cats||[]).map(c => `<button class="cat-btn" onclick="renderItems('${c.id}', this)">${c.name}</button>`).join('');
Â  Â  Â  Â  Â  Â  if(cats.length) renderItems(cats[0].id, document.querySelector('.cat-btn'));
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderItems(cid, el) {
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('cat-active'));
Â  Â  Â  Â  Â  Â  el.classList.add('cat-active');
Â  Â  Â  Â  Â  Â  document.getElementById('menu-grid').innerHTML = menuData.filter(i => i.category_id === cid).map(i => `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white rounded-3xl p-4 shadow-sm flex h-36 gap-4 border border-white" onclick="openDetail('${i.id}')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-32 flex-shrink-0"><img src="${i.image_url || ''}" class="img-contain"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1 flex flex-col justify-between py-1 overflow-hidden text-left">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><h3 class="font-bold text-p-green text-lg truncate font-serif">${i.name}</h3><p class="text-[10px] text-stone-400 line-clamp-2">${i.description || 'ç¶“å…¸å®¶å‘³ã€‚'}</p></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-end"><span class="text-p-gold font-black font-serif text-lg">$${i.price}</span><span class="text-[9px] bg-stone-100 px-3 py-1.5 rounded-full font-bold text-stone-400">é¸æ“‡</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>`).join('');
Â  Â  Â  Â  }

Â  Â  Â  Â  function openDetail(id) {
Â  Â  Â  Â  Â  Â  tempItem = menuData.find(i => i.id === id); if(!tempItem) return;
Â  Â  Â  Â  Â  Â  currentQty = 1; document.getElementById('item-qty').innerText = 1;
Â  Â  Â  Â  Â  Â  document.getElementById('detail-img').src = tempItem.image_url || '';
Â  Â  Â  Â  Â  Â  document.getElementById('detail-title').innerText = tempItem.name;
Â  Â  Â  Â  Â  Â  document.getElementById('detail-desc').innerText = tempItem.description || "çœŸå¿ƒæ¬¾å¾…ï¼Œèª æ‘¯æ»‹å‘³ã€‚";
Â  Â  Â  Â  Â  Â  document.getElementById('flavor-container').innerHTML = '';
Â  Â  Â  Â  Â  Â  document.getElementById('set-group-container').innerHTML = '';

Â  Â  Â  Â  Â  Â  if(tempItem.item_flavor_relation?.length > 0) renderFlavorUI(tempItem.item_flavor_relation, 'flavor-container', 'main-item');
Â  Â  Â  Â  Â  Â  if(tempItem.is_set_menu && tempItem.set_menu_groups) {
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('set-group-container').innerHTML = tempItem.set_menu_groups.map(g => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="group-block text-left" data-name="${g.group_name}" data-limit="${g.selection_limit}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center mb-3 text-left"><p class="font-bold text-p-green font-serif border-l-2 border-p-gold pl-2 uppercase text-[12px]">${g.group_name}</p><span class="text-[9px] text-stone-300 font-bold">å¿…é¸ ${g.selection_limit}</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-2 gap-2 text-left">${g.set_menu_contents.map((c, idx) => `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="set-item-card border rounded-xl overflow-hidden" id="sub-${g.id}-${c.menu_items.id}-${idx}" data-id="${c.menu_items.id}" data-name="${c.menu_items.name}" data-has-flv="${c.menu_items.item_flavor_relation?.length > 0}" data-selected-flv="">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div onclick="handleSubClick('sub-${g.id}-${c.menu_items.id}-${idx}')" class="p-3 bg-stone-50 flex justify-between items-center cursor-pointer text-xs font-bold"><span>${c.menu_items.name}</span>${c.menu_items.item_flavor_relation?.length>0?'<span class="text-[8px] text-p-gold">â—</span>':''}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="flv-sub-${g.id}-${c.menu_items.id}-${idx}" class="bg-stone-100 p-2 hidden border-t"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`).join('')}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`).join('');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  document.getElementById('detail-modal').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  // é–‹å•Ÿæ™‚é‡ç½®æ»¾å‹•ä½ç½®
Â  Â  Â  Â  Â  Â  document.querySelector('.scroll-area').scrollTop = 0;
Â  Â  Â  Â  Â  Â  document.getElementById('add-btn').onclick = confirmAdd;
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderFlavorUI(rels, target, parentID) {
Â  Â  Â  Â  Â  Â  const container = document.getElementById(target);
Â  Â  Â  Â  Â  Â  container.innerHTML += rels.map(r => `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flv-block text-left">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-[9px] text-stone-300 font-bold mb-2 uppercase tracking-widest">${r.flavor_groups.name}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-wrap gap-2">${r.flavor_groups.flavor_options.map(o => `<div onclick="selectFlv(this, '${parentID}')" class="flv-opt px-4 py-1.5 border rounded-full text-[11px] bg-stone-50 transition cursor-pointer" data-val="${o.option_name}">${o.option_name}</div>`).join('')}</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>`).join('');
Â  Â  Â  Â  }

Â  Â  Â  Â  function selectFlv(el, parentID) {
Â  Â  Â  Â  Â  Â  Array.from(el.parentElement.children).forEach(c => c.classList.remove('flavor-selected'));
Â  Â  Â  Â  Â  Â  el.classList.add('flavor-selected');
Â  Â  Â  Â  Â  Â  if (parentID !== 'main-item') {
Â  Â  Â  Â  Â  Â  Â  Â  const card = document.getElementById(parentID);
Â  Â  Â  Â  Â  Â  Â  Â  card.dataset.selectedFlv = Array.from(card.querySelectorAll('.flavor-selected')).map(o => o.dataset.val).join('/');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function handleSubClick(uid) {
Â  Â  Â  Â  Â  Â  const card = document.getElementById(uid); const block = card.closest('.group-block'); const limit = parseInt(block.dataset.limit);
Â  Â  Â  Â  Â  Â  if (limit === 1) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Array.from(block.querySelectorAll('.set-item-card')).forEach(c => { c.classList.remove('opt-selected'); c.querySelector('div[id^="flv-"]').classList.add('hidden'); });
Â  Â  Â  Â  Â  Â  Â  Â  card.classList.add('opt-selected');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  if (card.classList.contains('opt-selected')) { card.classList.remove('opt-selected'); card.querySelector('div[id^="flv-"]').classList.add('hidden'); return; }
Â  Â  Â  Â  Â  Â  Â  Â  if (block.querySelectorAll('.opt-selected').length >= limit) return alert(`æœ¬å€ä¸Šé™ç‚º ${limit} é …`);
Â  Â  Â  Â  Â  Â  Â  Â  card.classList.add('opt-selected');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (card.dataset.hasFlv === "true") {
Â  Â  Â  Â  Â  Â  Â  Â  const area = document.getElementById(`flv-${uid}`); const sub = menuData.find(m => m.id === card.dataset.id);
Â  Â  Â  Â  Â  Â  Â  Â  area.innerHTML = ''; renderFlavorUI(sub.item_flavor_relation, area.id, uid); area.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function confirmAdd() {
Â  Â  Â  Â  Â  Â  let mn = "";
Â  Â  Â  Â  Â  Â  if (tempItem.item_flavor_relation?.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const sels = Array.from(document.querySelectorAll('#flavor-container .flavor-selected'));
Â  Â  Â  Â  Â  Â  Â  Â  if (sels.length < tempItem.item_flavor_relation.length) return alert("è«‹é¸å–å®¢è£½å£å‘³");
Â  Â  Â  Â  Â  Â  Â  Â  mn = ` [${sels.map(o => o.dataset.val).join('/')}]`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  let sn = [];
Â  Â  Â  Â  Â  Â  if (tempItem.is_set_menu) {
Â  Â  Â  Â  Â  Â  Â  Â  for (let b of document.querySelectorAll('.group-block')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const sels = b.querySelectorAll('.opt-selected');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (sels.length < parseInt(b.dataset.limit)) return alert(`ã€${b.dataset.name}ã€‘å°šæœªé¸æ»¿`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (let c of sels) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (c.dataset.hasFlv === "true" && !c.dataset.selectedFlv) return alert(`è«‹é¸æ“‡ã€${c.dataset.name}ã€‘å£å‘³`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sn.push(c.dataset.name + (c.dataset.selectedFlv ? ` [${c.dataset.selectedFlv}]` : ''));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  const name = `${tempItem.name}${currentQty>1?' x'+currentQty:''}${mn}${sn.length?' ('+sn.join('ã€')+')':''}`;
Â  Â  Â  Â  Â  Â  cart.push({ name, price: tempItem.price * currentQty });
Â  Â  Â  Â  Â  Â  document.getElementById('cart-count').innerText = cart.length; closeDetail();
Â  Â  Â  Â  }

Â  Â  Â  Â  function changeQty(v) { currentQty = Math.max(1, currentQty + v); document.getElementById('item-qty').innerText = currentQty; }
Â  Â  Â  Â  function closeDetail() { document.getElementById('detail-modal').classList.add('hidden'); }
Â  Â  Â  Â  function closePreview() { document.getElementById('preview-modal').classList.add('hidden'); }
Â  Â  Â  Â  function openPreview() {
Â  Â  Â  Â  Â  Â  if(!cart.length) return;
Â  Â  Â  Â  Â  Â  document.getElementById('preview-list').innerHTML = cart.map((i, idx) => `<div class="flex justify-between items-start bg-stone-50 p-3 rounded-xl border text-left leading-relaxed"><div class="text-[11px] font-bold text-p-green flex-1">${i.name}<br><span class="text-p-gold font-serif mt-1 block">$${i.price}</span></div><button onclick="cart.splice(${idx},1);openPreview();document.getElementById('cart-count').innerText=cart.length;if(!cart.length)closePreview();" class="text-red-200 p-2 text-lg">âœ•</button></div>`).join('');
Â  Â  Â  Â  Â  Â  document.getElementById('preview-total').innerText = `$${cart.reduce((s,i)=>s+i.price,0)}`;
Â  Â  Â  Â  Â  Â  document.getElementById('preview-modal').classList.remove('hidden');
Â  Â  Â  Â  }

Â  Â  Â  Â  async function finalSubmit() {
Â  Â  Â  Â  Â  Â  const { error } = await _s.from('orders').insert([{ customer_name: guest.name, phone: guest.phone, order_content: cart, total_price: cart.reduce((s,i)=>s+i.price,0), note: document.getElementById('order-note').value }]);
Â  Â  Â  Â  Â  Â  if(!error) { document.getElementById('preview-modal').classList.add('hidden'); document.getElementById('step-2').classList.add('hidden'); document.getElementById('cart-bar').classList.add('hidden'); document.getElementById('step-3').classList.remove('hidden'); window.scrollTo(0,0); }
Â  Â  Â  Â  }
Â  Â  </script>
</body>
</html>
